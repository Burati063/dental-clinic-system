<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backup Management - Dental Clinic</title>
    <link rel="stylesheet" href="../../css/admin/admin-backup.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="main-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-tooth"></i>
                        <span class="logo-text">Dental Clinic</span>
                    </div>
                </div>

                <nav class="sidebar-nav">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="dashboard.html" class="nav-link">
                                <i class="fas fa-home nav-icon"></i>
                                <span class="nav-text">Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="users.html" class="nav-link">
                                <i class="fas fa-users nav-icon"></i>
                                <span class="nav-text">User Management</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="backup.html" class="nav-link active">
                                <i class="fas fa-database nav-icon"></i>
                                <span class="nav-text">Backup System</span>
                            </a>
                        </li> 
                    </ul>
                </nav>

                <div class="sidebar-footer">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="sidebar-user-name">Loading...</div>
                            <div class="user-role" id="sidebar-user-role">Administrator</div>
                        </div>
                    </div>
                    <button class="logout-btn sidebar-logout" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-content">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>

                    <div class="search-section">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Search backups..." id="globalSearch">
                        </div>
                    </div>

                    <div class="header-actions">
                        <div class="action-item">
                            <button class="action-btn">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notificationCount">0</span>
                            </button>
                        </div>
                        <div class="action-item user-profile-dropdown">
                            <button class="user-profile-btn">
                                <div class="user-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="user-info">
                                    <span class="user-name" id="header-user-name">Loading...</span>
                                    <span class="user-role" id="header-user-role">Administrator</span>
                                </div>
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Backup Content -->
            <main class="content-area">
                <div class="backup-management">
                    <div class="page-header">
                        <div class="header-content">
                            <h1>Backup Management</h1>
                            <p>Manage database backups and restore points</p>
                        </div>
                        <button class="btn btn-primary" onclick="createNewBackup()">
                            <i class="fas fa-plus"></i> Create New Backup
                        </button>
                    </div>

                    <!-- Backup Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-main">
                                    <div class="stat-number" id="total-backups">-</div>
                                    <div class="stat-label">Total Backups</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card success">
                            <div class="stat-content">
                                <div class="stat-main">
                                    <div class="stat-number" id="total-storage">-</div>
                                    <div class="stat-label">Total Storage Used</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-hdd"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card warning">
                            <div class="stat-content">
                                <div class="stat-main">
                                    <div class="stat-number" id="last-backup">-</div>
                                    <div class="stat-label">Last Backup</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card info">
                            <div class="stat-content">
                                <div class="stat-main">
                                    <div class="stat-number" id="auto-backup-status">-</div>
                                    <div class="stat-label">Auto Backup</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup Controls -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Backup Controls</h2>
                        </div>
                        <div class="card-body">
                            <div class="backup-controls">
                                <div class="control-group">
                                    <label>Backup Type</label>
                                    <select class="form-control" id="backupType">
                                        <option value="full">Full Database Backup</option>
                                        <option value="patients">Patients Data Only</option>
                                        <option value="records">Medical Records Only</option>
                                        <option value="users">Users Data Only</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label>Compression</label>
                                    <select class="form-control" id="compressionLevel">
                                        <option value="none">No Compression</option>
                                        <option value="low" selected>Low Compression</option>
                                        <option value="high">High Compression</option>
                                    </select>
                                </div>

                                <div class="control-group">
                                    <label class="checkbox">
                                        <input type="checkbox" id="includeFiles" checked>
                                        <span>Include uploaded files and media</span>
                                    </label>
                                </div>

                                <div class="control-actions">
                                    <button class="btn btn-primary" onclick="createCustomBackup()">
                                        <i class="fas fa-database"></i> Create Custom Backup
                                    </button>
                                    <button class="btn btn-outline" onclick="showBackupSettings()">
                                        <i class="fas fa-cog"></i> Backup Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup List -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Available Backups</h2>
                            <div class="header-actions">
                                <button class="btn btn-sm btn-outline" onclick="refreshBackupList()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="exportBackupList()">
                                    <i class="fas fa-download"></i> Export List
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-actions">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" placeholder="Search backups..." class="form-control" id="backupSearch">
                                </div>
                                <div class="filter-actions">
                                    <select class="form-control" id="backupFilter">
                                        <option value="all">All Backups</option>
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="manual">Manual Backups</option>
                                        <option value="auto">Auto Backups</option>
                                    </select>
                                </div>
                            </div>

                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>
                                                <label class="checkbox">
                                                    <input type="checkbox" id="select-all-backups">
                                                    <span></span>
                                                </label>
                                            </th>
                                            <th>Backup Name</th>
                                            <th>Type</th>
                                            <th>Size</th>
                                            <th>Date Created</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="backups-table-body">
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                <div class="loading-state">
                                                    <i class="fas fa-spinner fa-spin"></i>
                                                    <p>Loading backups...</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Bulk Actions -->
                            <div class="bulk-actions hidden" id="bulkActions">
                                <div class="bulk-info">
                                    <span id="selected-backups-count">0</span> backups selected
                                </div>
                                <div class="bulk-buttons">
                                    <button class="btn btn-sm btn-outline" onclick="bulkDownloadBackups()">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="bulkRestoreBackups()">
                                        <i class="fas fa-redo"></i> Restore
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="bulkDeleteBackups()">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Auto Backup Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Automatic Backup Settings</h2>
                        </div>
                        <div class="card-body">
                            <div class="auto-backup-settings">
                                <div class="setting-group">
                                    <label class="checkbox large">
                                        <input type="checkbox" id="enableAutoBackup" checked>
                                        <span>
                                            <strong>Enable Automatic Backups</strong>
                                            <small>System will automatically create backups based on schedule</small>
                                        </span>
                                    </label>
                                </div>

                                <div class="setting-row">
                                    <div class="setting-item">
                                        <label>Frequency</label>
                                        <select class="form-control" id="backupFrequency">
                                            <option value="daily">Daily</option>
                                            <option value="weekly" selected>Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>

                                    <div class="setting-item">
                                        <label>Backup Time</label>
                                        <input type="time" class="form-control" id="backupTime" value="02:00">
                                    </div>

                                    <div class="setting-item">
                                        <label>Retention Period</label>
                                        <select class="form-control" id="retentionPeriod">
                                            <option value="7">7 days</option>
                                            <option value="30" selected>30 days</option>
                                            <option value="90">90 days</option>
                                            <option value="365">1 year</option>
                                            <option value="0">Keep forever</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="setting-actions">
                                    <button class="btn btn-primary" onclick="saveBackupSettings()">
                                        <i class="fas fa-save"></i> Save Settings
                                    </button>
                                    <button class="btn btn-outline" onclick="testBackupConfiguration()">
                                        <i class="fas fa-test"></i> Test Configuration
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup History -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Backup History</h2>
                        </div>
                        <div class="card-body">
                            <div class="backup-history">
                                <div class="history-chart">
                                    <div class="chart-placeholder">
                                        <i class="fas fa-chart-bar"></i>
                                        <p>Backup history chart will appear here</p>
                                    </div>
                                </div>
                                <div class="history-stats">
                                    <div class="history-stat">
                                        <div class="stat-value" id="successful-backups">-</div>
                                        <div class="stat-label">Successful</div>
                                    </div>
                                    <div class="history-stat">
                                        <div class="stat-value" id="failed-backups">-</div>
                                        <div class="stat-label">Failed</div>
                                    </div>
                                    <div class="history-stat">
                                        <div class="stat-value" id="total-backup-size">-</div>
                                        <div class="stat-label">Total Size</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create Backup Modal -->
    <div class="modal-overlay hidden" id="createBackupModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create New Backup</h3>
                <button class="modal-close" onclick="hideCreateBackupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="backup-progress hidden" id="backupProgress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Creating backup... 0%</div>
                </div>
                <div class="backup-summary" id="backupSummary">
                    <p>Are you sure you want to create a new backup?</p>
                    <div class="backup-details">
                        <div class="detail-item">
                            <strong>Type:</strong> <span id="modal-backup-type">Full Database Backup</span>
                        </div>
                        <div class="detail-item">
                            <strong>Compression:</strong> <span id="modal-compression">Low</span>
                        </div>
                        <div class="detail-item">
                            <strong>Include Files:</strong> <span id="modal-include-files">Yes</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideCreateBackupModal()">Cancel</button>
                <button class="btn btn-primary" id="confirmBackupBtn" onclick="confirmCreateBackup()">Create Backup</button>
            </div>
        </div>
    </div>

    <!-- Restore Backup Modal -->
    <div class="modal-overlay hidden" id="restoreBackupModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Restore Backup</h3>
                <button class="modal-close" onclick="hideRestoreBackupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to restore this backup? This action will replace current data and cannot be undone.</p>
                <div class="backup-info">
                    <strong id="restore-backup-name">backup_file.sql</strong>
                    <div class="backup-meta">
                        <span id="restore-backup-size">0 MB</span> • 
                        <span id="restore-backup-date">Unknown date</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideRestoreBackupModal()">Cancel</button>
                <button class="btn btn-warning" id="confirmRestoreBtn">Restore Backup</button>
            </div>
        </div>
    </div>

    <!-- Delete Backup Modal -->
    <div class="modal-overlay hidden" id="deleteBackupModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Delete Backup</h3>
                <button class="modal-close" onclick="hideDeleteBackupModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this backup? This action cannot be undone.</p>
                <div class="backup-info">
                    <strong id="delete-backup-name">backup_file.sql</strong>
                    <div class="backup-meta">
                        <span id="delete-backup-size">0 MB</span> • 
                        <span id="delete-backup-date">Unknown date</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hideDeleteBackupModal()">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Delete Backup</button>
            </div>
        </div>
    </div>

    <script src="../../js/core/utils.js"></script>
    <script src="../../js/core/api.js"></script>
    <script src="../../js/core/auth.js"></script>
    <script src="../../js/admin/backup-system.js"></script>
</body>
</html>